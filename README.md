# E-COM тестовое задание

### Задача

Требуется создать веб-приложение для определения заполненных форм

Приложение должно:

* хранить список шаблонов форм в базе данных
* принимать POST-запросы с данными формы и возвращать имя подходящего шаблона
* поддерживать четыре типа данных полей: email, телефон, дата, текст(все типы кроме текста должны поддерживать валидацию)
* в случае отсутствия подходящего шаблона возвращать типизацию полей

### Результат

* создано FastAPI приложение
* в качестве базы данных используется MongoDB с асинхронным драйвером Motor
* добавлен класс MongoEngine для выполнения запросов к базе данных
* добавлен класс FormTemplateRepository для генерации шаблонов форм
* добавлен класс FormTemplateService для выполнения логики валидации и определения подходящего шаблона формы
* реализован метод, который возвращает шаблон с наибольшим числом совпадений типов полей
* в случае равенства числа совпадений проверяется соответствие названий шаблонов названиям ключей в переданном запросе
* создан тестовый скрипт для проверки работы приложения

### Пояснения

|Компонент|Задача|
|---|---|
|MongoEngine|Класс, который выполняет запросы к базе данных MongoDB. Метод execute принимает имя коллекции и строку запроса, выполняет запрос и возвращает результат|
|FormTemplateRepository|Класс, который генерирует шаблоны форм. Метод generate_form_template использует MongoEngine для выполнения запроса и возвращает AsyncGenerator с данными шаблонов|
|FormTemplateService|Класс, который выполняет логику валидации и определения подходящего шаблона формы. Метод get_form принимает данные формы, использует FormTemplateRepository для генерации шаблонов, подсчитывает число совпадений типов полей и возвращает имя шаблона с наибольшим числом совпадений. Метод _validate_field_type проверяет тип поля (email, телефон, дата, текст). Метод _resolve_template_name_conflict разрешает конфликты имен шаблонов, используя SequenceMatcher для сравнения схожести строк|
 
### Запуск приложения

1. Установка зависимостей:
 
```
poetry install
```

2. Создание файла с переменными окружения

```
cp .env.example .env
```

3. Запуск docker-compose
 
```
docker compose --env-file .env up --build -d
```

3. Отправка тестовых запросы к API
 
```
poetry run python3 ./tests/functional/test_form_template.py
```